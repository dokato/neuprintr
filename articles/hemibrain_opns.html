<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hemibrain olfactory projection neurons • neuprintr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="hemibrain olfactory projection neurons">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">neuprintr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/customquery.html">Writing query functions in neuprintr</a>
    </li>
    <li>
      <a href="../articles/hemibrain_opns.html">hemibrain olfactory projection neurons</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/natverse/neuprintr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>hemibrain olfactory projection neurons</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/natverse/neuprintr/blob/master/vignettes/hemibrain_opns.Rmd"><code>vignettes/hemibrain_opns.Rmd</code></a></small>
      <div class="hidden name"><code>hemibrain_opns.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>“FROM many directions, workers are tunnelling hopefully into the mountain, some with steam shovels and others with dental drills. Some travel blindly in a circle and come out close to their point of entrance; some connect, usually in a mismatched fashion, with the burrows of others. Some have chosen to disregard the random activities of their fellows and have worked out in a small region an elegant system of tunnels of their own. Both the attraction and confusion of this multitudinous excavation lie in the fact that none of these workers knows precisely what they are looking for, or what they will find.” (<a href="https://www.springer.com/gp/book/9783642692734">Kenneth Roeder</a>)</p>
</blockquote>
<div id="inspecting-the-hemibrain" class="section level1">
<h1 class="hasAnchor">
<a href="#inspecting-the-hemibrain" class="anchor"></a>Inspecting the hemibrain</h1>
<p>The largest draft connectome to date was released on the 22nd of January, 2020. The <a href="https://www.janelia.org/project-team/flyem/hemibrain">FlyEM Janelia HemiBrain project</a> has released 21,662 neurons, many more fragments, and almost 10 million synapses. About 35% of its automatically predicted synapses have been matched up to a semi-automatically traced ‘body’ deemed large enough to constitute an identifiable neuron. This data can be accessed using our R package <a href="https://github.com/natverse/neuprintr/">neuprintr</a> to query a publically accessible <a href="https://neuprint.janelia.org/">neuPrint explorer instance</a>.</p>
<div id="lock-and-load" class="section level2">
<h2 class="hasAnchor">
<a href="#lock-and-load" class="anchor"></a>Lock and load</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'devtools'</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'natverse'</span>)) devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">"natverse/natverse"</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"BiocManager"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))<span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"BiocManager"</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'ComplexHeatmap'</span>)) BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">"ComplexHeatmap"</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'ggnetwork'</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"ggnetwork"</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'network'</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"network"</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># load</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(natverse)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(neuprintr)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dendroextras)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ComplexHeatmap)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggnetwork)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(network)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co"># Colours</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">## some nice colors!! Inspired by LaCroixColoR</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">lacroix =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#C70E7B"</span>, <span class="st">"#FC6882"</span>, <span class="st">"#007BC3"</span>, <span class="st">"#54BCD1"</span>, <span class="st">"#EF7C12"</span>, <span class="st">"#F4B95A"</span>, </a>
<a class="sourceLine" id="cb1-20" data-line-number="20">            <span class="st">"#009F3F"</span>, <span class="st">"#8FDA04"</span>, <span class="st">"#AF6125"</span>, <span class="st">"#F4E3C7"</span>, <span class="st">"#B25D91"</span>, <span class="st">"#EFC7E6"</span>, </a>
<a class="sourceLine" id="cb1-21" data-line-number="21">            <span class="st">"#EF7C12"</span>, <span class="st">"#F4B95A"</span>, <span class="st">"#C23A4B"</span>, <span class="st">"#FBBB48"</span>, <span class="st">"#EFEF46"</span>, <span class="st">"#31D64D"</span>, </a>
<a class="sourceLine" id="cb1-22" data-line-number="22">            <span class="st">"#132157"</span>,<span class="st">"#EE4244"</span>, <span class="st">"#D72000"</span>, <span class="st">"#1BB6AF"</span>)</a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(lacroix) =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"purple"</span>, <span class="st">"pink"</span>,</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">                   <span class="st">"blue"</span>, <span class="st">"cyan"</span>,</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">                   <span class="st">"darkorange"</span>, <span class="st">"paleorange"</span>,</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">                   <span class="st">"darkgreen"</span>, <span class="st">"green"</span>,</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">                   <span class="st">"brown"</span>, <span class="st">"palebrown"</span>,</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">                   <span class="st">"mauve"</span>, <span class="st">"lightpink"</span>,</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">                   <span class="st">"orange"</span>, <span class="st">"midorange"</span>,</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">                   <span class="st">"darkred"</span>, <span class="st">"darkyellow"</span>,</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">                   <span class="st">"yellow"</span>, <span class="st">"palegreen"</span>, </a>
<a class="sourceLine" id="cb1-32" data-line-number="32">                   <span class="st">"navy"</span>,<span class="st">"cerise"</span>,</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">                   <span class="st">"red"</span>, <span class="st">"marine"</span>)</a>
<a class="sourceLine" id="cb1-34" data-line-number="34"></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">## Then see if a simple function works for you:</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">available.datasets =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_info.html">neuprint_datasets</a></span>()</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">available.datasets</a></code></pre></div>
<p>If you need help/have not before logged into neuPrint via R, please see the package README or see <code><a href="../reference/neuprint_login.html">?neuprint_login</a></code>.</p>
<p>The main point is that To make life easier, you can then edit your R.environ file to contain information about the neuPrint server you want to speak with, your token and the dataset hosted by that server, that you want to read. You can use the package <code>usethis</code> to easily edit your R environ file. You will need to add this line to your R environ to specify the hemibrain dataset:</p>
<p><code>neuprint_token="YOUR_TOKEN_HERE"</code> <code>neuprint_server='https://neuprint.janelia.org/'</code> <code>neuprint_dataset='hemibrain:v1.0'</code></p>
<p>Then restart your R session.</p>
</div>
<div id="find-neurons" class="section level2">
<h2 class="hasAnchor">
<a href="#find-neurons" class="anchor"></a>Find neurons</h2>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_an_opn.png" alt="hemibrain_an_opn"><p class="caption">hemibrain_an_opn</p>
</div>
<p>First, we need to find neurons to read from neuPrint. We can do this easily in two ways - we can search by name, and we can search by brain region.</p>
<p>So what do we want to look at? Some of the best studied neurons in the brain are the olfactory projections neurons (OPNs) <a href="https://www.ncbi.nlm.nih.gov/pubmed/27653699">Grabe et al. 2016</a>. These are second-order olfactory neurons that project from the fly’s equivalent of the olfactory bulb, i.e. the antennal lobe, to higher order brain regions that generate innate behaviours (the lateral horn, LH) <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6550879">(Frechter. 209,</a> <a href="https://www.ncbi.nlm.nih.gov/pubmed/31112130">Dolan et al. 2019)</a> and learning &amp; memory (the mushroom body) <a href="https://www.ncbi.nlm.nih.gov/pubmed/25535793">(Aso et al. 2014a,</a> <a href="https://www.ncbi.nlm.nih.gov/pubmed/25535794">Aso et al. 2014b)</a>. We know a fair bit about them, compared with most neurons in the fly brain. For example, a bit of their odour response profiles <a href="https://www.ncbi.nlm.nih.gov/pubmed/27321924">Badel et al., 2016</a>.</p>
<p>Perhaps we could look at some popular OPN types and see if they connect to each other? How do we get this information?</p>
<p>Let’s find some in our HemiBrain data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">### Let's find some in our HemiBrain data:</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">opn.info =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_search.html">neuprint_search</a></span>(<span class="st">".*mPN1.*"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">opn.info[<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(opn.info<span class="op">$</span>type),<span class="st">"type"</span>] =<span class="st"> </span>opn.info[<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(opn.info<span class="op">$</span>type),<span class="st">"name"</span>]</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(opn.info) =<span class="st"> </span>opn.info<span class="op">$</span>bodyid</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">#### Add AL glomerulus information from the name</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">name.split =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(opn.info<span class="op">$</span>name,<span class="dt">split=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"</span><span class="ch">\\</span><span class="st">(|</span><span class="ch">\\</span><span class="st">_"</span>))</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">gloms =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(name.split, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>(x[[<span class="dv">2</span>]], <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="st">""</span>))</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">opn.info<span class="op">$</span>glomerulus =<span class="st"> </span>gloms</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">opn.info =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(opn.info, glomerulus<span class="op">!=</span><span class="st">""</span>)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">#### so there seem to be</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(gloms))</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">#### OPNs and</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">#### And</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(gloms)))</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">#### OPNs with unique glomerulus innervations</a>
<a class="sourceLine" id="cb2-16" data-line-number="16"></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">## Let's see what meta-info we get, along with stuff with 'mPN1' in the name.</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">## This is a reference to the OPN naming scheme by Tanaka et al. (2012)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(opn.info)</a>
<a class="sourceLine" id="cb2-20" data-line-number="20">### Looks like we get their unique ID numbers (bodyIds), cell names,</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">### types, their size (voxels) and synapse numbers (pre=output, post=input).</a>
<a class="sourceLine" id="cb2-22" data-line-number="22"></a>
<a class="sourceLine" id="cb2-23" data-line-number="23">## Let's quickly read one neuron, and have a look at it!</a>
<a class="sourceLine" id="cb2-24" data-line-number="24">opn =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_read_neurons.html">neuprint_read_neuron</a></span>(opn.info<span class="op">$</span>bodyid[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2-25" data-line-number="25">### visualise:</a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.985064148902893</span>, <span class="fl">0.164582148194313</span>, </a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="fl">0.05061025172472</span>, <span class="dv">0</span>, <span class="fl">0.00997132062911987</span>, <span class="fl">-0.347956597805023</span>, </a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="fl">0.93745756149292</span>, <span class="dv">0</span>, <span class="fl">0.171898916363716</span>, <span class="fl">-0.922951519489288</span>, <span class="fl">-0.344400823116302</span>, </a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.746215641498566</span>, </a>
<a class="sourceLine" id="cb2-30" data-line-number="30">    <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(20L, 65L, 1191L, 843L)) <span class="co"># set view</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="kw">plot3d</span>(opn, <span class="dt">WithConnectors =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> lacroix[[<span class="st">"brown"</span>]], <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="st">"images"</span>)</a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_an_opn.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)</a>
<a class="sourceLine" id="cb2-34" data-line-number="34">### output synapses in red, input ones in blue</a>
<a class="sourceLine" id="cb2-35" data-line-number="35">### You can see the auto-segmentation goes a bit crazy where the soma is</a>
<a class="sourceLine" id="cb2-36" data-line-number="36"></a>
<a class="sourceLine" id="cb2-37" data-line-number="37">## Now that we have all of the bodyIds, we can read these neurons from neuPrint:</a>
<a class="sourceLine" id="cb2-38" data-line-number="38">opns =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_read_neurons.html">neuprint_read_neuron_simple</a></span>(opn.info<span class="op">$</span>bodyid)</a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.98370349407196</span>, <span class="fl">-0.104569993913174</span>, </a>
<a class="sourceLine" id="cb2-40" data-line-number="40">                                 <span class="fl">-0.146263062953949</span>, <span class="dv">0</span>, <span class="fl">0.147007316350937</span>, <span class="fl">-0.000597098842263222</span>, </a>
<a class="sourceLine" id="cb2-41" data-line-number="41">                                 <span class="fl">0.989135324954987</span>, <span class="dv">0</span>, <span class="fl">-0.103521309792995</span>, <span class="fl">-0.994517505168915</span>, </a>
<a class="sourceLine" id="cb2-42" data-line-number="42">                                 <span class="fl">0.0147849693894386</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.644609212875366</span>, </a>
<a class="sourceLine" id="cb2-43" data-line-number="43">        <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(20L, 65L, 1191L, 843L))</a>
<a class="sourceLine" id="cb2-44" data-line-number="44"><span class="kw">plot3d</span>(opns, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(lacroix,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(opns), <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_opns.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)</a>
<a class="sourceLine" id="cb2-46" data-line-number="46"></a>
<a class="sourceLine" id="cb2-47" data-line-number="47">## The simple version of read neurons just reads the skeleton for a neuron</a>
<a class="sourceLine" id="cb2-48" data-line-number="48">### We might also want our neuron objects to contain meta data and synapse information</a>
<a class="sourceLine" id="cb2-49" data-line-number="49">### We have an all-in-one function to do this. Here we go!</a>
<a class="sourceLine" id="cb2-50" data-line-number="50">opns =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_read_neurons.html">neuprint_read_neuron_simple</a></span>(opn.info<span class="op">$</span>bodyid)</a>
<a class="sourceLine" id="cb2-51" data-line-number="51"></a>
<a class="sourceLine" id="cb2-52" data-line-number="52">##But why is this function so slow?</a>
<a class="sourceLine" id="cb2-53" data-line-number="53">### Because it fetches fragmented neuron skeletons assigned to the same neuron</a>
<a class="sourceLine" id="cb2-54" data-line-number="54">### Stitched them into one neuron (healing), grabs all the neuron's synapses</a>
<a class="sourceLine" id="cb2-55" data-line-number="55">### and tries to work out where the soma is. If you want to move faster</a>
<a class="sourceLine" id="cb2-56" data-line-number="56">### You can grab bits separately and quickly:</a>
<a class="sourceLine" id="cb2-57" data-line-number="57">?neuprint_read_neuron_simple</a>
<a class="sourceLine" id="cb2-58" data-line-number="58">?neuprint_get_synapses</a>
<a class="sourceLine" id="cb2-59" data-line-number="59">?neuprint_assign_connectors</a>
<a class="sourceLine" id="cb2-60" data-line-number="60">?neuprint_locate_soma</a>
<a class="sourceLine" id="cb2-61" data-line-number="61">?neuprint_get_neuron_names</a>
<a class="sourceLine" id="cb2-62" data-line-number="62">?neuprint_get_meta</a>
<a class="sourceLine" id="cb2-63" data-line-number="63"></a>
<a class="sourceLine" id="cb2-64" data-line-number="64">## Do we have to know what's in the name to find interesting neurons? No!</a>
<a class="sourceLine" id="cb2-65" data-line-number="65">### We can also read neurons from a region of interest (ROI) of the brain.</a>
<a class="sourceLine" id="cb2-66" data-line-number="66">### The regions of interest available are:</a>
<a class="sourceLine" id="cb2-67" data-line-number="67">rois =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="../reference/neuprint_ROIs.html">neuprint_ROIs</a></span>())</a>
<a class="sourceLine" id="cb2-68" data-line-number="68">rois</a>
<a class="sourceLine" id="cb2-69" data-line-number="69"></a>
<a class="sourceLine" id="cb2-70" data-line-number="70">## We don't we try fetching all of the neurons in a glomerulus of the mushroom body input zone, the calyx?</a>
<a class="sourceLine" id="cb2-71" data-line-number="71">ca.info =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_find_neurons.html">neuprint_find_neurons</a></span>(</a>
<a class="sourceLine" id="cb2-72" data-line-number="72">  <span class="dt">input_ROIs =</span> <span class="st">"CA(R)"</span>,</a>
<a class="sourceLine" id="cb2-73" data-line-number="73">  <span class="dt">output_ROIs =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-74" data-line-number="74">  <span class="dt">all_segments =</span> <span class="ot">FALSE</span> <span class="co"># if true, fragments smaller than 'neurons' are returned as well</span></a>
<a class="sourceLine" id="cb2-75" data-line-number="75">)</a>
<a class="sourceLine" id="cb2-76" data-line-number="76"></a>
<a class="sourceLine" id="cb2-77" data-line-number="77">## So how many neurons is that?</a>
<a class="sourceLine" id="cb2-78" data-line-number="78"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(ca.info))</a>
<a class="sourceLine" id="cb2-79" data-line-number="79"></a>
<a class="sourceLine" id="cb2-80" data-line-number="80">## A lot! But what about that pesky load of Kenyon cells</a>
<a class="sourceLine" id="cb2-81" data-line-number="81">### The most populous neurons in the brain</a>
<a class="sourceLine" id="cb2-82" data-line-number="82">ca.info =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(ca.info, <span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(bodyname) <span class="op">&amp;</span><span class="st"> </span>neuronStatus <span class="op">==</span><span class="st"> "Traced"</span>)</a>
<a class="sourceLine" id="cb2-83" data-line-number="83">ca.info =<span class="st"> </span>ca.info[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"KC"</span>,ca.info<span class="op">$</span>bodyname),]</a>
<a class="sourceLine" id="cb2-84" data-line-number="84"></a>
<a class="sourceLine" id="cb2-85" data-line-number="85">## So how many neurons is that?</a>
<a class="sourceLine" id="cb2-86" data-line-number="86"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(ca.info))</a>
<a class="sourceLine" id="cb2-87" data-line-number="87"></a>
<a class="sourceLine" id="cb2-88" data-line-number="88">## Getting all that data took a while, so let's save it for later</a>
<a class="sourceLine" id="cb2-89" data-line-number="89"><span class="kw"><a href="https://rdrr.io/r/base/save.html">save</a></span>(opns,<span class="dt">file =</span> <span class="st">"hemibrain_opns.rda"</span>)</a></code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_opns.png" alt="hemibrain_opns"><p class="caption">hemibrain_opns</p>
</div>
</div>
<div id="get-neuropil-volumes" class="section level2">
<h2 class="hasAnchor">
<a href="#get-neuropil-volumes" class="anchor"></a>Get neuropil volumes</h2>
<p>So it is nice that we now have some neurons. But it would be good to see them with their neuropil context.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_olfactory_neuropils.png" alt="hemibrain_olfactory_neuropils"><p class="caption">hemibrain_olfactory_neuropils</p>
</div>
<p>Let’s fetch some volume data to plot:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">## Let's get some neuropil volume data from neuPrint!</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">### Specifically, in the last R file we chose to look at OPNs</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">### So let's fetch their meshes for the antennal lobe!</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">### First, we gotta see what is available:</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">rois</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"># Read in the AL mesh!</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">al.mesh =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span>(<span class="dt">roi =</span> <span class="st">"AL(R)"</span>)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.947127282619476</span>, <span class="fl">0.222770735621452</span>, </a>
<a class="sourceLine" id="cb3-10" data-line-number="10">                                 <span class="fl">-0.230919197201729</span>, <span class="dv">0</span>, <span class="fl">0.247805655002594</span>, <span class="fl">-0.0506941750645638</span>, </a>
<a class="sourceLine" id="cb3-11" data-line-number="11">                                 <span class="fl">0.967482566833496</span>, <span class="dv">0</span>, <span class="fl">0.203820571303368</span>, <span class="fl">-0.973551869392395</span>, </a>
<a class="sourceLine" id="cb3-12" data-line-number="12">                                 <span class="fl">-0.103217624127865</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.58467960357666</span>, </a>
<a class="sourceLine" id="cb3-13" data-line-number="13">        <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(1460L, 65L, 2877L, 996L)) <span class="co"># set view</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw">plot3d</span>(al.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">col =</span> lacroix[[<span class="st">"orange"</span>]])</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co"># And  get the other main olfactory neuropils</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">ca.mesh =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span>(<span class="dt">roi =</span> <span class="st">"CA(R)"</span>)</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">lh.mesh =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span>(<span class="dt">roi =</span> <span class="st">"LH(R)"</span>)</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">malt.mesh =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span>(<span class="dt">roi =</span> <span class="st">"mALT(R)"</span>)</a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="kw">plot3d</span>(ca.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">col =</span> lacroix[[<span class="st">"pink"</span>]])</a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="kw">plot3d</span>(lh.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">col =</span> lacroix[[<span class="st">"green"</span>]])</a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="kw">plot3d</span>(malt.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.9</span>, <span class="dt">col =</span> <span class="st">"grey30"</span>)</a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_olfactory_neuropils.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)</a>
<a class="sourceLine" id="cb3-24" data-line-number="24"></a>
<a class="sourceLine" id="cb3-25" data-line-number="25">## Maybe get the whole hemibrai mesh?</a>
<a class="sourceLine" id="cb3-26" data-line-number="26">## hemibrain = neuprint_ROI_mesh(roi = "hemibrain")</a>
<a class="sourceLine" id="cb3-27" data-line-number="27"></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="co"># And with some neurons!</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.98370349407196</span>, <span class="fl">-0.104569993913174</span>, </a>
<a class="sourceLine" id="cb3-30" data-line-number="30">                                 <span class="fl">-0.146263062953949</span>, <span class="dv">0</span>, <span class="fl">0.147007316350937</span>, <span class="fl">-0.000597098842263222</span>, </a>
<a class="sourceLine" id="cb3-31" data-line-number="31">                                 <span class="fl">0.989135324954987</span>, <span class="dv">0</span>, <span class="fl">-0.103521309792995</span>, <span class="fl">-0.994517505168915</span>, </a>
<a class="sourceLine" id="cb3-32" data-line-number="32">                                 <span class="fl">0.0147849693894386</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.644609212875366</span>, </a>
<a class="sourceLine" id="cb3-33" data-line-number="33">        <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(20L, 65L, 1191L, 843L))</a>
<a class="sourceLine" id="cb3-34" data-line-number="34"><span class="kw">plot3d</span>(al.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="kw">plot3d</span>(ca.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb3-36" data-line-number="36"><span class="kw">plot3d</span>(lh.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb3-37" data-line-number="37"><span class="kw">plot3d</span>(opns, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(lacroix,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(opns), <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-38" data-line-number="38"><span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_opns_neuropils.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)</a></code></pre></div>
<p>Here is what the neurons look like with these brain meshes:</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_opns_neuropils.png" alt="hemibrain_opns_neuropils"><p class="caption">hemibrain_opns_neuropils</p>
</div>
</div>
<div id="get-connectivity" class="section level2">
<h2 class="hasAnchor">
<a href="#get-connectivity" class="anchor"></a>Get connectivity</h2>
<p>And now the really exciting bit! How do these neurons connect to each other?</p>
<p>First we will look at connectivity between OPN types.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_uPN_connections.png" alt="hemibrain_uPN_connections"><p class="caption">hemibrain_uPN_connections</p>
</div>
<p>Then we will follow up on their connectivity with other neurons in the brain. We will focus on the uniglomerular projection neuron (uPN) from the apple cider vinegar detecting glomerulus, DM1. It is already known that it is a hub for connectivity in the lateral horn, impinging on the axons of other food-odour related projection neurons <a href="https://www.biorxiv.org/content/10.1101/2020.01.19.911453v1">(Bates and Schlegel et al., 2020)</a>. We’ll see in the code below, that we can find that this PNs’ (orange) strongest downstream targets include these neurons in the lateral horn (the part of the brain that generates ‘innate’ behaviours):</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_DM1_strong_LH_targets.png" alt="hemibrain_DM1_strong_LH_targets"><p class="caption">hemibrain_DM1_strong_LH_targets</p>
</div>
<p>And that other uPNs can influence them both directly and via interstitial neurons:</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_uPN_inputs_to_select_LHNs.png" alt="hemibrain_uPN_inputs_to_select_LHNs"><p class="caption">hemibrain_uPN_inputs_to_select_LHNs</p>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">## We are looking at connectivity between OPNs.</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">### We can get an adjaceny matrix between all of these OPNs</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">opn.adj =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_get_adjacency_matrix.html">neuprint_get_adjacency_matrix</a></span>(<span class="dt">bodyids =</span> opn.info<span class="op">$</span>bodyid)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(opn.adj) =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(opn.adj) =<span class="st"> </span>opn.info<span class="op">$</span>type</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">## Let's visualise this connectivity</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">my_palette &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(lacroix[[<span class="st">"cyan"</span>]],lacroix[[<span class="st">"yellow"</span>]], lacroix[[<span class="st">"orange"</span>]], lacroix[[<span class="st">"cerise"</span>]])) (<span class="dt">n=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="dt">file =</span> <span class="st">"images/OPN_interconnectivity.pdf"</span>, <span class="dt">height =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="kw">Heatmap</span>(opn.adj,</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">        <span class="dt">col =</span> my_palette)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">## It is hard to parse this information mentally</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">### What if we just see what the glomerulus to glomerulus connectivity is?</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">opn.adj.comp =<span class="st"> </span>opn.adj</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(opn.adj.comp) =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(opn.adj.comp) =<span class="st"> </span>opn.info<span class="op">$</span>glomerulus</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">opn.adj.comp =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(opn.adj.comp), <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(opn.adj.comp), sum, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">opn.adj.comp =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(opn.adj.comp, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(opn.adj.comp), sum, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="kw"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="dt">file =</span> <span class="st">"images/OPN_glomerulus_interconnectivity.pdf"</span>, <span class="dt">height =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="kw">Heatmap</span>(opn.adj.comp,</a>
<a class="sourceLine" id="cb4-21" data-line-number="21">        <span class="dt">col =</span> my_palette)</a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="kw"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</a>
<a class="sourceLine" id="cb4-23" data-line-number="23"></a>
<a class="sourceLine" id="cb4-24" data-line-number="24">## What about OPN connectivity to neurons not in this set of OPNs?</a>
<a class="sourceLine" id="cb4-25" data-line-number="25">### First, is there a common partner to all OPNs?</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">common =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_common_connectivity.html">neuprint_common_connectivity</a></span>(opn.info<span class="op">$</span>bodyid, <span class="dt">prepost =</span> <span class="st">"PRE"</span>) <span class="co"># could use 'post' for downstream</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(common) </a>
<a class="sourceLine" id="cb4-28" data-line-number="28"></a>
<a class="sourceLine" id="cb4-29" data-line-number="29">### What about the food hub PNs?</a>
<a class="sourceLine" id="cb4-30" data-line-number="30">### The glomerulus DM1 is interesting, because it is involved in an axo-axonic</a>
<a class="sourceLine" id="cb4-31" data-line-number="31">### 'food odour' related community in the lateral horn (Bates &amp; Schlegel et al. 2020)</a>
<a class="sourceLine" id="cb4-32" data-line-number="32">DM1.opn.info =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(opn.info, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"DM1|DM3|DM4|VM3|VA4"</span>,name))</a>
<a class="sourceLine" id="cb4-33" data-line-number="33">DM1.common =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_common_connectivity.html">neuprint_common_connectivity</a></span>(DM1.opn.info<span class="op">$</span>bodyid, <span class="dt">prepost =</span> <span class="st">"PRE"</span>)</a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(DM1.common) </a>
<a class="sourceLine" id="cb4-35" data-line-number="35">DM1.common.meta =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_get_meta.html">neuprint_get_meta</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(DM1.common)) <span class="co"># what are they?</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(DM1.common.meta) <span class="co"># Huhh, local neurons, the APL and some LH stuff</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"></a>
<a class="sourceLine" id="cb4-38" data-line-number="38">## We can also get all of the neurons in the database that connect to the</a>
<a class="sourceLine" id="cb4-39" data-line-number="39">### query neurons, either upstream or downstream of them</a>
<a class="sourceLine" id="cb4-40" data-line-number="40">DM1.opn.connected =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_connection_table.html">neuprint_connection_table</a></span>(DM1.opn.info<span class="op">$</span>bodyid, <span class="dt">prepost =</span> <span class="st">"POST"</span>)</a>
<a class="sourceLine" id="cb4-41" data-line-number="41">### In which brain region are these partners?</a>
<a class="sourceLine" id="cb4-42" data-line-number="42"><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(DM1.opn.connected<span class="op">$</span>roi)</a>
<a class="sourceLine" id="cb4-43" data-line-number="43"></a>
<a class="sourceLine" id="cb4-44" data-line-number="44">## Important note!!</a>
<a class="sourceLine" id="cb4-45" data-line-number="45">### The results from neuprint_connection_table can list the same bodyid-partner pairing</a>
<a class="sourceLine" id="cb4-46" data-line-number="46">### multiple times if by.roi = TRUE. This is because there is a separate entry for each of FlyEM's designated</a>
<a class="sourceLine" id="cb4-47" data-line-number="47">### regions of interest (ROIs), and because a super-level ROI can include multiple smaller ROIs. </a>
<a class="sourceLine" id="cb4-48" data-line-number="48"></a>
<a class="sourceLine" id="cb4-49" data-line-number="49">## Let's have a look at what the strongest downstream partners look like</a>
<a class="sourceLine" id="cb4-50" data-line-number="50">DM1.opn.connected.strong =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(DM1.opn.connected,weight<span class="op">&gt;</span><span class="dv">100</span>, <span class="dt">prepost =</span> <span class="st">"POST"</span>)</a>
<a class="sourceLine" id="cb4-51" data-line-number="51">DM1.targets =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_read_neurons.html">neuprint_read_neurons</a></span>(DM1.opn.connected.strong<span class="op">$</span>partner)</a>
<a class="sourceLine" id="cb4-52" data-line-number="52">DM1.targets =<span class="st"> </span><span class="kw">unspike</span>(DM1.targets, <span class="dt">threshold=</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb4-53" data-line-number="53"><span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.964227318763733</span>, <span class="fl">-0.0444099828600883</span>, </a>
<a class="sourceLine" id="cb4-54" data-line-number="54"><span class="fl">-0.261329621076584</span>, <span class="dv">0</span>, <span class="fl">0.249727189540863</span>, <span class="fl">-0.178416073322296</span>, </a>
<a class="sourceLine" id="cb4-55" data-line-number="55"><span class="fl">0.951737523078918</span>, <span class="dv">0</span>, <span class="fl">-0.088891975581646</span>, <span class="fl">-0.982952415943146</span>, </a>
<a class="sourceLine" id="cb4-56" data-line-number="56"><span class="fl">-0.160943150520325</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.783526360988617</span>, </a>
<a class="sourceLine" id="cb4-57" data-line-number="57">    <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span>6L, 71L, 1434L, 927L))</a>
<a class="sourceLine" id="cb4-58" data-line-number="58"><span class="kw">plot3d</span>(DM1.targets, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(lacroix,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(DM1.targets),<span class="dt">replace=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb4-59" data-line-number="59"><span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_DM1_strong_downstream_partners.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)</a>
<a class="sourceLine" id="cb4-60" data-line-number="60"><span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(DM1.targets[,])</a>
<a class="sourceLine" id="cb4-61" data-line-number="61"></a>
<a class="sourceLine" id="cb4-62" data-line-number="62">## So there are three lateral horn neuron targets of the axon there</a>
<a class="sourceLine" id="cb4-63" data-line-number="63">### c("359214479", "359891881", "511616870"), found using nat::find.neuron</a>
<a class="sourceLine" id="cb4-64" data-line-number="64">### Let's move forward with those</a>
<a class="sourceLine" id="cb4-65" data-line-number="65">lhns =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"359214479"</span>, <span class="st">"359891881"</span>, <span class="st">"511616870"</span>)</a>
<a class="sourceLine" id="cb4-66" data-line-number="66">lhn.cols =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(lacroix[[<span class="st">"marine"</span>]],lacroix[[<span class="st">"blue"</span>]],lacroix[[<span class="st">"green"</span>]])</a>
<a class="sourceLine" id="cb4-67" data-line-number="67"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(lhn.cols) =<span class="st"> </span>DM1.targets[lhns,<span class="st">"type"</span>]</a>
<a class="sourceLine" id="cb4-68" data-line-number="68">lh.targets =<span class="st"> </span>DM1.targets[lhns]</a>
<a class="sourceLine" id="cb4-69" data-line-number="69"><span class="kw">clear3d</span>()</a>
<a class="sourceLine" id="cb4-70" data-line-number="70"><span class="kw">plot3d</span>(lh.targets, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(lacroix[[<span class="st">"marine"</span>]],</a>
<a class="sourceLine" id="cb4-71" data-line-number="71">                                    lacroix[[<span class="st">"blue"</span>]],</a>
<a class="sourceLine" id="cb4-72" data-line-number="72">                                    lacroix[[<span class="st">"green"</span>]]))</a>
<a class="sourceLine" id="cb4-73" data-line-number="73"><span class="kw">plot3d</span>(<span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(opns,<span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"DM1"</span>,name)),<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span>lacroix[[<span class="st">"orange"</span>]])</a>
<a class="sourceLine" id="cb4-74" data-line-number="74"><span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_DM1_strong_LH_targets.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)</a>
<a class="sourceLine" id="cb4-75" data-line-number="75"></a>
<a class="sourceLine" id="cb4-76" data-line-number="76">## Can other OPNs influence these strong partners?</a>
<a class="sourceLine" id="cb4-77" data-line-number="77">### Which other OPNs impinge on it?</a>
<a class="sourceLine" id="cb4-78" data-line-number="78">### Via whatever path?</a>
<a class="sourceLine" id="cb4-79" data-line-number="79">shortest.paths =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>()</a>
<a class="sourceLine" id="cb4-80" data-line-number="80"><span class="cf">for</span>(lhn <span class="cf">in</span> lhns){</a>
<a class="sourceLine" id="cb4-81" data-line-number="81">  <span class="cf">for</span>(b <span class="cf">in</span> opn.info<span class="op">$</span>bodyid){ <span class="co"># PN -&gt; LHN</span></a>
<a class="sourceLine" id="cb4-82" data-line-number="82">    sp =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_get_shortest_paths.html">neuprint_get_shortest_paths</a></span>(<span class="dt">body_pre =</span> b, <span class="dt">body_post =</span> lhn, <span class="dt">weightT =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb4-83" data-line-number="83">    dupe =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(sp<span class="op">$</span>to))[<span class="dv">1</span>]),<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(sp),<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(sp<span class="op">$</span>to))[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb4-84" data-line-number="84">    shortest =<span class="st"> </span>sp[<span class="dv">1</span><span class="op">:</span>dupe,]</a>
<a class="sourceLine" id="cb4-85" data-line-number="85">    <span class="cf">if</span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest)<span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest)<span class="op">&lt;</span><span class="dv">5</span> ){</a>
<a class="sourceLine" id="cb4-86" data-line-number="86">      shortest<span class="op">$</span>order.to =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest), <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest), <span class="dt">sep =</span> <span class="st">"/"</span>)</a>
<a class="sourceLine" id="cb4-87" data-line-number="87">      shortest<span class="op">$</span>order.from =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest)<span class="op">-</span><span class="dv">1</span>, <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest), <span class="dt">sep =</span> <span class="st">"/"</span>)</a>
<a class="sourceLine" id="cb4-88" data-line-number="88">      shortest[<span class="dv">1</span>,<span class="st">"order.from"</span>] =<span class="st"> </span>opn.info[<span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(b),<span class="st">"glomerulus"</span>]</a>
<a class="sourceLine" id="cb4-89" data-line-number="89">      shortest[<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest),<span class="st">"order.to"</span>] =<span class="st"> </span>DM1.targets[lhn,<span class="st">"type"</span>]</a>
<a class="sourceLine" id="cb4-90" data-line-number="90">      shortest.paths =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(shortest.paths, shortest) </a>
<a class="sourceLine" id="cb4-91" data-line-number="91">    }</a>
<a class="sourceLine" id="cb4-92" data-line-number="92">  }</a>
<a class="sourceLine" id="cb4-93" data-line-number="93">  <span class="cf">for</span>(b <span class="cf">in</span> opn.info<span class="op">$</span>bodyid){ <span class="co"># LHN -&gt; PN</span></a>
<a class="sourceLine" id="cb4-94" data-line-number="94">    sp =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_get_shortest_paths.html">neuprint_get_shortest_paths</a></span>(<span class="dt">body_post =</span> b, <span class="dt">body_pre =</span> lhn, <span class="dt">weightT =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb4-95" data-line-number="95">    dupe =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(sp<span class="op">$</span>to))[<span class="dv">1</span>]),<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(sp),<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(sp<span class="op">$</span>to))[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb4-96" data-line-number="96">    shortest =<span class="st"> </span>sp[<span class="dv">1</span><span class="op">:</span>dupe,]</a>
<a class="sourceLine" id="cb4-97" data-line-number="97">    <span class="cf">if</span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest)<span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest)<span class="op">&lt;</span><span class="dv">2</span>){</a>
<a class="sourceLine" id="cb4-98" data-line-number="98">      shortest[<span class="dv">1</span>,<span class="st">"order.from"</span>] =<span class="st"> </span>opn.info[<span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(b),<span class="st">"glomerulus"</span>]</a>
<a class="sourceLine" id="cb4-99" data-line-number="99">      shortest[<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest),<span class="st">"order.to"</span>] =<span class="st"> </span>DM1.targets[lhn,<span class="st">"type"</span>]</a>
<a class="sourceLine" id="cb4-100" data-line-number="100">      shortest.paths =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(shortest.paths, shortest) </a>
<a class="sourceLine" id="cb4-101" data-line-number="101">    }</a>
<a class="sourceLine" id="cb4-102" data-line-number="102">  }</a>
<a class="sourceLine" id="cb4-103" data-line-number="103">}</a>
<a class="sourceLine" id="cb4-104" data-line-number="104"></a>
<a class="sourceLine" id="cb4-105" data-line-number="105"><span class="co"># Make network</span></a>
<a class="sourceLine" id="cb4-106" data-line-number="106"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb4-107" data-line-number="107">paths =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">weight =</span> shortest.paths<span class="op">$</span>weight), <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">order.from =</span> shortest.paths<span class="op">$</span>order.from,</a>
<a class="sourceLine" id="cb4-108" data-line-number="108">                                                             <span class="dt">order.to =</span> shortest.paths<span class="op">$</span>order.to),</a>
<a class="sourceLine" id="cb4-109" data-line-number="109">                           sum)</a>
<a class="sourceLine" id="cb4-110" data-line-number="110">n =<span class="st"> </span><span class="kw">network</span>(paths,</a>
<a class="sourceLine" id="cb4-111" data-line-number="111">            <span class="dt">matrix.type =</span> <span class="st">"edgelist"</span>,</a>
<a class="sourceLine" id="cb4-112" data-line-number="112">            <span class="dt">ignore.eval =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-113" data-line-number="113">            <span class="dt">layout =</span> <span class="st">"fruchtermanreingold"</span>,</a>
<a class="sourceLine" id="cb4-114" data-line-number="114">            <span class="dt">names.eval =</span> <span class="st">"weight"</span>,</a>
<a class="sourceLine" id="cb4-115" data-line-number="115">            <span class="dt">directed =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-116" data-line-number="116">n =<span class="st"> </span><span class="kw">ggnetwork</span>(n, <span class="dt">cell.jitter =</span> <span class="fl">0.75</span>, <span class="dt">arrow.gap =</span> <span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb4-117" data-line-number="117"></a>
<a class="sourceLine" id="cb4-118" data-line-number="118"><span class="co"># Set colours</span></a>
<a class="sourceLine" id="cb4-119" data-line-number="119">orders =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(paths<span class="op">$</span>order.to,paths<span class="op">$</span>order.from))</a>
<a class="sourceLine" id="cb4-120" data-line-number="120">order.cols =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"grey30"</span>,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(orders))</a>
<a class="sourceLine" id="cb4-121" data-line-number="121"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(order.cols) =<span class="st"> </span>orders</a>
<a class="sourceLine" id="cb4-122" data-line-number="122">gloms =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(opn.info<span class="op">$</span>glomerulus)</a>
<a class="sourceLine" id="cb4-123" data-line-number="123">opn.cols =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(lacroix[[<span class="st">"orange"</span>]],<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(gloms))</a>
<a class="sourceLine" id="cb4-124" data-line-number="124"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(opn.cols) =<span class="st"> </span>gloms</a>
<a class="sourceLine" id="cb4-125" data-line-number="125">opn.cols =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(opn.cols,lhn.cols,order.cols[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(order.cols)<span class="op">%in%</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(lhn.cols),<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(opn.cols))])</a>
<a class="sourceLine" id="cb4-126" data-line-number="126"></a>
<a class="sourceLine" id="cb4-127" data-line-number="127"><span class="co"># Plot</span></a>
<a class="sourceLine" id="cb4-128" data-line-number="128"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-129" data-line-number="129"><span class="kw"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="dt">file =</span> <span class="st">"images/DM1_OPN_input_graph.pdf"</span>, <span class="dt">height =</span> <span class="dv">5</span>, <span class="dt">width =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb4-130" data-line-number="130"><span class="kw">ggplot</span>(n, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-131" data-line-number="131"><span class="st">  </span><span class="kw">geom_edges</span>(<span class="kw">aes</span>(<span class="dt">color =</span> vertex.names),</a>
<a class="sourceLine" id="cb4-132" data-line-number="132">             <span class="dt">curvature =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb4-133" data-line-number="133">             <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">"pt"</span>), </a>
<a class="sourceLine" id="cb4-134" data-line-number="134">                           <span class="dt">type =</span> <span class="st">"closed"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-135" data-line-number="135"><span class="st">  </span><span class="kw">geom_nodes</span>(<span class="kw">aes</span>(<span class="dt">color =</span> vertex.names, <span class="dt">size =</span> <span class="dv">6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-136" data-line-number="136"><span class="st">  </span><span class="kw">geom_edgetext</span>(<span class="kw">aes</span>(<span class="dt">label =</span> weight, <span class="dt">color =</span> vertex.names), <span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-137" data-line-number="137"><span class="st">  </span><span class="kw">geom_nodelabel_repel</span>(<span class="kw">aes</span>(<span class="dt">color =</span> vertex.names, <span class="dt">label =</span> vertex.names),</a>
<a class="sourceLine" id="cb4-138" data-line-number="138">                       <span class="dt">fontface =</span> <span class="st">"bold"</span>, <span class="dt">box.padding =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">"lines"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-139" data-line-number="139"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> opn.cols) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-140" data-line-number="140"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> opn.cols) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-141" data-line-number="141"><span class="st">  </span><span class="kw">theme_blank</span>() <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb4-142" data-line-number="142"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="ot">FALSE</span>, <span class="dt">shape =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="ot">FALSE</span>, <span class="dt">linetype =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>)</a>
<a class="sourceLine" id="cb4-143" data-line-number="143"><span class="kw"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</a></code></pre></div>
</div>
<div id="article" class="section level2">
<h2 class="hasAnchor">
<a href="#article" class="anchor"></a>Article</h2>
<p><strong>A Connectome of the Adult Drosophila Central Brain</strong></p>
<p>Shan Xu, C; Januszewski, Michal; Lu, Zhiyuan; Takemura, Shin-Ya; Hayworth, Kenneth; Huang, Gary; Shinomiya, Kazunori; Maitin-Shepard, Jeremy; Ackerman, David; Berg, Stuart; Blakely, Tim; Bogovic, John; Clements, Jody; Dolafi, Tom; Hubbard, Philip; Kainmueller, Dagmar; Katz, William; Kawase, Takashi; Khairy, Khaled; Leavitt, Laramie; Li, Peter H; Lindsey, Larry; Neubarth, Nicole; Olbris, Donald J; Otsuna, Hideo; Troutman, Eric T; Umayam, Lowell; Zhao, Ting; Ito, Masayoshi; Goldammer, Jens; Wolff, Tanya; Svirskas, Robert; Schlegel, Philipp; Neace, Erika R; Knecht, Christopher J; Alvarado, Chelsea X; Bailey, Dennis; Ballinger, Samantha; Borycz, Jolanta A; Canino, Brandon; Cheatham, Natasha; Cook, Michael; Dreyer, Marisa; Duclos, Octave; Eubanks, Bryon; Fairbanks, Kelli; Finley, Samantha; Forknall, Nora; Francis, Audrey; Hopkins, Gary Patrick; Joyce, Emily M; Kim, Sungjin; Kirk, Nicole A; Kovalyak, Julie; Lauchie, Shirley A; Lohff, Alanna; Maldonado, Charli; Manley, Emily A; McLin, Sari; Mooney, Caroline; Ndama, Miatta; Ogundeyi, Omotara; Okeoma, Nneoma; Ordish, Christopher; Padilla, Nicholas; Patrick, Christopher; Paterson, Tyler; Phillips, Elliott E; Phillips, Emily M; Rampally, Neha; Ribeiro, Caitlin; Robertson, Madelaine K; Rymer, Jon Thomson; Ryan, Sean M; Sammons, Megan; Scott, Anne K; Scott, Ashley L; Shinomiya, Aya; Smith, Claire; Smith, Kelsey; Smith, Natalie L; Sobeski, Margaret A; Suleiman, Alia; Swift, Jackie; Takemura, Satoko; Talebi, Iris; Tarnogorska, Dorota; Tenshaw, Emily; Tokhi, Temour; Walsh, John J; Yang, Tansy; Horne, Jane Anne; Li, Feng; Parekh, Ruchi; Rivlin, Patricia K; Jayaraman, Vivek; Ito, Kei; Saalfeld, Stephan; George, Reed; Meinertzhagen, Ian; Rubin, Gerald M; Hess, Harald F; Scheffer, Louis K; Jain, Viren; Plaza, Stephen M</p>
<p>bioRxiv, Jan 21, 2020 <a href="https://www.biorxiv.org/content/10.1101/2020.01.21.911859v1">10.1101/2020.01.21.911859</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#inspecting-the-hemibrain">Inspecting the hemibrain</a><ul class="nav nav-pills nav-stacked">
<li><a href="#lock-and-load">Lock and load</a></li>
      <li><a href="#find-neurons">Find neurons</a></li>
      <li><a href="#get-neuropil-volumes">Get neuropil volumes</a></li>
      <li><a href="#get-connectivity">Get connectivity</a></li>
      <li><a href="#article">Article</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexander Bates, Gregory Jefferis, Romain Franconville.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
