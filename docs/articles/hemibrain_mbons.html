<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hemibrain msuhroom body output neurons • neuprintr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="hemibrain msuhroom body output neurons">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">neuprintr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/hemibrain_mbons.html">hemibrain msuhroom body output neurons</a>
    </li>
    <li>
      <a href="../articles/hemibrain_opns.html">hemibrain olfactory projection neurons</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/natverse/neuprintr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>hemibrain msuhroom body output neurons</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/natverse/neuprintr/blob/master/vignettes/hemibrain_mbons.Rmd"><code>vignettes/hemibrain_mbons.Rmd</code></a></small>
      <div class="hidden name"><code>hemibrain_mbons.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>“WHEN the systems approach can be connected to the mechanisms approach so that its feedback loop and automata becomes clothed in flesh and blood, we shall see real and exciting progress in understanding behaviour.” (<a href="https://www.springer.com/gp/book/9783642692734">Kenneth Roeder</a></p>
</blockquote>
<div id="inspecting-the-hemibrain" class="section level1">
<h1 class="hasAnchor">
<a href="#inspecting-the-hemibrain" class="anchor"></a>Inspecting the hemibrain</h1>
<p>The largest draft connectome to date was released on the 22nd of January, 2020. The <a href="https://www.janelia.org/project-team/flyem/hemibrain">FlyEM Janelia HemiBrain project</a> has released 21,662, many more fragments, and almost 10 million synapses. About 35% of its automatically predicted synapses have been matched up to a semi-automatically traced ‘body’ deemed large enough to constitute and identifiable neuron. This data can be accessed using our R package <a href="https://github.com/natverse/neuprintr/">neuprintr</a> to query a publically accessible <a href="https://neuprint.janelia.org/">neuPrint explorer instance</a>.</p>
<div id="lock-and-load" class="section level2">
<h2 class="hasAnchor">
<a href="#lock-and-load" class="anchor"></a>Lock and load</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install</span>
<span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'devtools'</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'natverse'</span>)) devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"natverse/natverse"</span>)
<span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'ComplexHeatmap'</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"ComplexHeatmap"</span>)
<span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'devtools'</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"ggnetwork"</span>)
<span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'devtools'</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"network"</span>)

<span class="co"># load</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(natverse)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(neuprintr)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dendroextras)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ComplexHeatmap)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggnetwork)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(network)

<span class="co"># Colours</span>
## some nice colors!! Inspired by LaCroixColoR
lacroix =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#C70E7B"</span>, <span class="st">"#FC6882"</span>, <span class="st">"#007BC3"</span>, <span class="st">"#54BCD1"</span>, <span class="st">"#EF7C12"</span>, <span class="st">"#F4B95A"</span>, 
            <span class="st">"#009F3F"</span>, <span class="st">"#8FDA04"</span>, <span class="st">"#AF6125"</span>, <span class="st">"#F4E3C7"</span>, <span class="st">"#B25D91"</span>, <span class="st">"#EFC7E6"</span>, 
            <span class="st">"#EF7C12"</span>, <span class="st">"#F4B95A"</span>, <span class="st">"#C23A4B"</span>, <span class="st">"#FBBB48"</span>, <span class="st">"#EFEF46"</span>, <span class="st">"#31D64D"</span>, 
            <span class="st">"#132157"</span>,<span class="st">"#EE4244"</span>, <span class="st">"#D72000"</span>, <span class="st">"#1BB6AF"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(lacroix) =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"purple"</span>, <span class="st">"pink"</span>,
                   <span class="st">"blue"</span>, <span class="st">"cyan"</span>,
                   <span class="st">"darkorange"</span>, <span class="st">"paleorange"</span>,
                   <span class="st">"darkgreen"</span>, <span class="st">"green"</span>,
                   <span class="st">"brown"</span>, <span class="st">"palebrown"</span>,
                   <span class="st">"mauve"</span>, <span class="st">"lightpink"</span>,
                   <span class="st">"orange"</span>, <span class="st">"midorange"</span>,
                   <span class="st">"darkred"</span>, <span class="st">"darkyellow"</span>,
                   <span class="st">"yellow"</span>, <span class="st">"palegreen"</span>, 
                   <span class="st">"navy"</span>,<span class="st">"cerise"</span>,
                   <span class="st">"red"</span>, <span class="st">"marine"</span>)

## Then see if a simple function works for you:
available.datasets =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_info.html">neuprint_datasets</a></span>()
available.datasets</code></pre></div>
<p>If you need help/have not before logged into neuPrint via R, please see the package README or see .</p>
<p>The main point is that To make life easier, you can then edit your R.environ file to contain information about the neuPrint server you want to speak with, your token and the dataset hosted by that server, that you want to read. You can use the package  to easily edit your R environ file. You will need to add this line to your R environ to specify the hemibrain dataset:</p>
<p>  </p>
<p>Then restart your R session.</p>
</div>
<div id="find-neurons" class="section level2">
<h2 class="hasAnchor">
<a href="#find-neurons" class="anchor"></a>Find neurons</h2>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_an_mbon.png" alt="hemibrain_an_mbon"><p class="caption">hemibrain_an_mbon</p>
</div>
<p>First, we need to find neurons to read from neuPrint. We can do this easily in two ways - we can search by name, and we can search by brain region.</p>
<p>So what do we want to look at? Perhaps we could look at some popular neuron types and see if they connect to each other? Mushroom body output neurons (MBONs) are a well-studied neuron class. They read-out stored associative memories, ‘located’ in the mushroom body of the flies. These mushroom bodies are split into compartments (e.g. a, alpha or y, gamma – further split into gamma 1-5, for example). That have different learning properties. Their light-level anatomy and role in memory have been well probed <a href="https://www.ncbi.nlm.nih.gov/pubmed/25535793">(Aso et al. 2014a,</a> <a href="https://www.ncbi.nlm.nih.gov/pubmed/25535794">Aso et al. 2014b)</a>.</p>
<p>Let’s find some in our HemiBrain data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">### Let's find some in our HemiBrain data:
mbon.info =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_search.html">neuprint_search</a></span>(<span class="st">".*MBON.*"</span>)
mbon.info[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(mbon.info<span class="op">$</span>type),<span class="st">"type"</span>] =<span class="st"> </span>mbon.info[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(mbon.info<span class="op">$</span>type),<span class="st">"name"</span>]
<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(mbon.info) =<span class="st"> </span>mbon.info<span class="op">$</span>bodyid
#### Add MB compartment information from the name
name.split =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(mbon.info<span class="op">$</span>name,<span class="dt">split=</span><span class="st">"</span><span class="ch">\\</span><span class="st">("</span>)
comps =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(name.split, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"</span><span class="ch">\\</span><span class="st">)|_|bi.*|R.*|L.*|</span><span class="ch">\\</span><span class="st">?.*|P.*"</span>,<span class="st">""</span>,x[[<span class="dv">2</span>]]), <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="st">""</span>))
mbon.info<span class="op">$</span>compartment =<span class="st"> </span>comps
mbon.info =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(mbon.info, compartment<span class="op">!=</span><span class="st">""</span>)
#### so there seem to be
<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(comps))
#### MBONs and
#### And
<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(comps)))
#### MBONs with unique compartment innervations
#### In the literature, there are 

## Let's see what meta-info we get, along with stuff with 'MBON' in the name
<span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(mbon.info)
### Looks like we get their unique ID numbers (bodyIds), cell names,
### types, their size (voxels) and synapse numbers (pre=output, post=input).

## Let's quickly read one neuron, and have a look at it!
mbon =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_read_neurons.html">neuprint_read_neuron</a></span>(mbon.info<span class="op">$</span>bodyid[<span class="dv">1</span>])
### visualise:
<span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.591208934783936</span>, <span class="fl">0.804114699363708</span>, 
                                  <span class="fl">0.0622238591313362</span>, <span class="dv">0</span>, <span class="op">-</span><span class="fl">0.0341671295464039</span>, <span class="op">-</span><span class="fl">0.0521107465028763</span>, 
                                  <span class="fl">0.998056709766388</span>, <span class="dv">0</span>, <span class="fl">0.805794537067413</span>, <span class="op">-</span><span class="fl">0.592186093330383</span>, 
                                  <span class="op">-</span><span class="fl">0.00333413854241371</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.710681617259979</span>, 
         <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(20L, 65L, 1191L, 843L)) <span class="co"># set view</span>
<span class="kw">plot3d</span>(mbon, <span class="dt">WithConnectors =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> lacroix[[<span class="st">"brown"</span>]], <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="st">"images"</span>)
<span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_an_mbon.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)
### output synapses in red, input ones in blue
### You can see the auto-segmentation goes a bit crazy where the soma is

## Now that we have all of the bodyIds, we can read these neurons from neuPrint:
mbons =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_read_neurons.html">neuprint_read_neurons</a></span>(mbon.info<span class="op">$</span>bodyid)
<span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.98370349407196</span>, <span class="op">-</span><span class="fl">0.104569993913174</span>, 
                                 <span class="op">-</span><span class="fl">0.146263062953949</span>, <span class="dv">0</span>, <span class="fl">0.147007316350937</span>, <span class="op">-</span><span class="fl">0.000597098842263222</span>, 
                                 <span class="fl">0.989135324954987</span>, <span class="dv">0</span>, <span class="op">-</span><span class="fl">0.103521309792995</span>, <span class="op">-</span><span class="fl">0.994517505168915</span>, 
                                 <span class="fl">0.0147849693894386</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.644609212875366</span>, 
        <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(20L, 65L, 1191L, 843L))
<span class="kw">plot3d</span>(mbons, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(lacroix,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(mbons), <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_mbons.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)
### Why is this function so slow?
### Because it fetches fragmented neuron skeletons assigned to the same neuron
### Stitched them into one neuron, grabs all the neuron's synapses
### and tries to work out where the soma is. If you want to move faster
### You can grab bits separately and quickly:
?neuprint_read_neuron_simple
?neuprint_get_synapses
?neuprint_assign_connectors
?neuprint_locate_soma

## Do we have to know what's in the name to find interesting neurons? No!
### We can also read neurons from a region of interest (ROI) of the brain.
### The regions of interest available are:
rois =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="../reference/neuprint_ROIs.html">neuprint_ROIs</a></span>())
rois

## We don't we try fetching all of the neurons in a compartment of the mushroombody lobes?
### The compartment a'3 is interesting, because it is involved in aversive odour learning
### and novetly detection (Aso et al. 2014; Hattori et al. 2016)
ap3.info =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_find_neurons.html">neuprint_find_neurons</a></span>(
  <span class="dt">input_ROIs =</span> <span class="st">"a'3(R)"</span>,
  <span class="dt">output_ROIs =</span> <span class="ot">NULL</span>,
  <span class="dt">all_segments =</span> <span class="ot">FALSE</span> <span class="co"># if true, fragments smaller than 'neurons' are returned as well</span>
)

## So how many neurons is that?
<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(ap3.info))

## A lot! But what about that pesky load of Kenyon cells
### The most populous neurons in the brain
ap3.info =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(ap3.info, <span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(bodyname) <span class="op">&amp;</span><span class="st"> </span>neuronStatus <span class="op">==</span><span class="st"> "Traced"</span>)
ap3.info =<span class="st"> </span>ap3.info[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"KC"</span>,ap3.info<span class="op">$</span>bodyname),]

## So how many neurons is that?
<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(ap3.info))

## Getting all that data took a while, so let's save it for later
<span class="kw"><a href="https://rdrr.io/r/base/save.html">save</a></span>(mbons,<span class="dt">file =</span> <span class="st">"hemibrain_mbons.rda"</span>)</code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_mbons_mb.png" alt="hemibrain_mbons_mb"><p class="caption">hemibrain_mbons_mb</p>
</div>
<p>So, previously ~35 MBON cells were known (variable between brains) that fall into ~22 types <a href="https://www.ncbi.nlm.nih.gov/pubmed/25535793">(Aso et al. 2014a,</a> <a href="https://www.ncbi.nlm.nih.gov/pubmed/25535794">Aso et al. 2014b,</a> <a href="https://www.ncbi.nlm.nih.gov/pubmed/28718765">Takemura et al. 2017)</a>. Here, according to the naming in the hemibrain project, there are putative 75 MBON cells that can be broken down into ~35 putative types.</p>
</div>
<div id="get-neuropil-volumes" class="section level2">
<h2 class="hasAnchor">
<a href="#get-neuropil-volumes" class="anchor"></a>Get neuropil volumes</h2>
<p>So it is nice that we now have some neurons. But it would be good to see them with their neuropil context.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/hemibrain_MB_ap3.png" alt="hemibrain_MB_ap3"><p class="caption">hemibrain_MB_ap3</p>
</div>
<p>Let’s fetch some volume data to plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Let's get some neuropil volume data from neuPrint!
### Specifically, in the last R file we chose to look at MBONs
### So let's fetch their meshes for the mushroombody!
### First, we gotta see what is available:
rois =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="../reference/neuprint_ROIs.html">neuprint_ROIs</a></span>())
rois

<span class="co"># Read in the MB mesh!</span>
mb.mesh =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span>(<span class="dt">roi =</span> <span class="st">"MB(R)"</span>)
<span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.947127282619476</span>, <span class="fl">0.222770735621452</span>, 
                                 <span class="op">-</span><span class="fl">0.230919197201729</span>, <span class="dv">0</span>, <span class="fl">0.247805655002594</span>, <span class="op">-</span><span class="fl">0.0506941750645638</span>, 
                                 <span class="fl">0.967482566833496</span>, <span class="dv">0</span>, <span class="fl">0.203820571303368</span>, <span class="op">-</span><span class="fl">0.973551869392395</span>, 
                                 <span class="op">-</span><span class="fl">0.103217624127865</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.58467960357666</span>, 
        <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(1460L, 65L, 2877L, 996L)) <span class="co"># set view</span>
<span class="kw">plot3d</span>(mb.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">col =</span> lacroix[[<span class="st">"pink"</span>]])

<span class="co"># And highlight compartment alpha prime 3</span>
ap3.mesh =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_ROI_mesh.html">neuprint_ROI_mesh</a></span>(<span class="dt">roi =</span> <span class="st">"a'3(R)"</span>)
<span class="kw">plot3d</span>(ap3.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> lacroix[[<span class="st">"purple"</span>]])
<span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_MB_ap3.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)

## Maybe get the whole hemibrai mesh?
## hemibrain = neuprint_ROI_mesh(roi = "hemibrain")

<span class="co"># And with some neurons!</span>
<span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.98370349407196</span>, <span class="op">-</span><span class="fl">0.104569993913174</span>, 
                                 <span class="op">-</span><span class="fl">0.146263062953949</span>, <span class="dv">0</span>, <span class="fl">0.147007316350937</span>, <span class="op">-</span><span class="fl">0.000597098842263222</span>, 
                                 <span class="fl">0.989135324954987</span>, <span class="dv">0</span>, <span class="op">-</span><span class="fl">0.103521309792995</span>, <span class="op">-</span><span class="fl">0.994517505168915</span>, 
                                 <span class="fl">0.0147849693894386</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.644609212875366</span>, 
        <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(20L, 65L, 1191L, 843L))
<span class="kw">plot3d</span>(mb.mesh, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)
<span class="kw">plot3d</span>(mbons, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(lacroix,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(mbons), <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_mbons_mb.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)</code></pre></div>
</div>
<div id="get-connectivity" class="section level2">
<h2 class="hasAnchor">
<a href="#get-connectivity" class="anchor"></a>Get connectivity</h2>
<p>And now the really exciting bit! How do these neurons connect to each others?</p>
<p>First we will look at connectivity between MBON types.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/mbon_compartment_connectivity.png" alt="mbon_compartment_connectivity"><p class="caption">mbon_compartment_connectivity</p>
</div>
<p>Then we will follow up on their connectivity with other neurons in the brain, and focus on a ‘teaching’ dopaminergic input onto a MBON type, MBON-a’3, which is thought to allow this MBON to act as a novelty detector <a href="https://www.ncbi.nlm.nih.gov/pubmed/28502772">(Hattori et al. 2017)</a>.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/natverse/neuprintr/master/inst/images/mbon_paths_to_PPL1ap3.png" alt="mbon_paths_to_PPL1ap3"><p class="caption">mbon_paths_to_PPL1ap3</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## We are looking at connectivity between MBONs.
### We can get an adjaceny matrix between all of these MBONs
mbon.adj =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_get_adjacency_matrix.html">neuprint_get_adjacency_matrix</a></span>(<span class="dt">bodyids =</span> mbon.info<span class="op">$</span>bodyid)
<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(mbon.adj) =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(mbon.adj) =<span class="st"> </span>mbon.info<span class="op">$</span>type

## Let's visualise this connectivity
my_palette &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(lacroix[[<span class="st">"cyan"</span>]],lacroix[[<span class="st">"yellow"</span>]], lacroix[[<span class="st">"orange"</span>]], lacroix[[<span class="st">"cerise"</span>]])) (<span class="dt">n=</span><span class="dv">20</span>)
<span class="kw"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="dt">file =</span> <span class="st">"images/MBON_interconnectivity.pdf"</span>, <span class="dt">height =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="dv">10</span>)
<span class="kw"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span>(mbon.adj,
        <span class="dt">col =</span> my_palette)
<span class="kw"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()

## It is hard to parse this information mentally
### What if we just see what the compartment to compartment connectivity is?
mbon.adj.comp =<span class="st"> </span>mbon.adj
<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(mbon.adj.comp) =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(mbon.adj.comp) =<span class="st"> </span>mbon.info<span class="op">$</span>compartment
mbon.adj.comp =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(mbon.adj.comp), <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(mbon.adj.comp), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))
mbon.adj.comp =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(mbon.adj.comp, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(mbon.adj.comp), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
<span class="kw"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="dt">file =</span> <span class="st">"images/MBON_compartment_interconnectivity.pdf"</span>, <span class="dt">height =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="dv">10</span>)
<span class="kw"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span>(mbon.adj.comp,
        <span class="dt">col =</span> my_palette)
<span class="kw"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()

## What about MBON connectivity to neurons not in this set of MBONs?
### First, is there a common partner to all MBONs?
common =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_common_connectivity.html">neuprint_common_connectivity</a></span>(mbon.info<span class="op">$</span>bodyid, <span class="dt">prepost =</span> <span class="st">"PRE"</span>) <span class="co"># could use 'post' for downstream</span>
<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(common) <span class="co"># nope!</span>
### What about all a'3 MBONs?
ap3.mbon.info =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(mbon.info, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"a'3"</span>,name))
ap3.common =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_common_connectivity.html">neuprint_common_connectivity</a></span>(ap3.mbon.info<span class="op">$</span>bodyid, <span class="dt">prepost =</span> <span class="st">"PRE"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(ap3.common) <span class="co"># so there are 25 common partners to the 4 MBONs</span>
ap3.common.meta =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_get_meta.html">neuprint_get_meta</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(ap3.common)) <span class="co"># what are they?</span>
<span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(ap3.common.meta) <span class="co"># ooh of course, the dopamine input (DAN) to a'3 and other weird things, but no KCs!</span>

## We can also get all of the neurons in the database that connect to the
### query neurons, either upstream or downstream of them
ap3.mbon.connected =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_connection_table.html">neuprint_connection_table</a></span>(ap3.mbon.info<span class="op">$</span>bodyid, <span class="dt">prepost =</span> <span class="st">"POST"</span>)
### In which brain region are these partners?
<span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(ap3.mbon.connected<span class="op">$</span>roi)

## Let's have a look at what the strongest downstream partners look like
ap3.mbon.connected.strong =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(ap3.mbon.connected,weight<span class="op">&gt;</span><span class="dv">30</span>, <span class="dt">prepost =</span> <span class="st">"POST"</span>)
ap3.targets =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_read_neurons.html">neuprint_read_neurons</a></span>(ap3.mbon.connected.strong<span class="op">$</span>partner)
ap3.targets =<span class="st"> </span><span class="kw">unspike</span>(ap3.targets, <span class="dt">threshold=</span><span class="dv">1000</span>)
<span class="kw">nopen3d</span>(<span class="dt">userMatrix =</span> <span class="kw"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.964227318763733</span>, <span class="op">-</span><span class="fl">0.0444099828600883</span>, 
                                 <span class="op">-</span><span class="fl">0.261329621076584</span>, <span class="dv">0</span>, <span class="fl">0.249727189540863</span>, <span class="op">-</span><span class="fl">0.178416073322296</span>, 
                                 <span class="fl">0.951737523078918</span>, <span class="dv">0</span>, <span class="op">-</span><span class="fl">0.088891975581646</span>, <span class="op">-</span><span class="fl">0.982952415943146</span>, 
                                 <span class="op">-</span><span class="fl">0.160943150520325</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">.Dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(4L, 4L)), <span class="dt">zoom =</span> <span class="fl">0.676839649677277</span>, 
        <span class="dt">windowRect =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(1440L, 45L, 2937L, 938L))
<span class="kw">plot3d</span>(ap3.targets, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(lacroix,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ap3.targets),<span class="dt">replace=</span><span class="ot">TRUE</span>))
<span class="kw">rgl.snapshot</span>(<span class="dt">filename =</span> <span class="st">"images/hemibrain_ap3_strong_downstream_partners.png"</span>, <span class="dt">fmt =</span><span class="st">"png"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(ap3.targets[,])

## Can other MBONs influence these strong partners?
### The cognate DAN for MBONs-a'3, PPL1-a'3, gets 49 (!) of its inputs from MBONs-a'3
### Which other MBONs impinge on it?
### Via whatever path?
shortest.paths =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>()
<span class="cf">for</span>(b <span class="cf">in</span> mbon.info<span class="op">$</span>bodyid){
  sp =<span class="st"> </span><span class="kw"><a href="../reference/neuprint_get_shortest_paths.html">neuprint_get_shortest_paths</a></span>(<span class="dt">body_pre =</span> b, <span class="dt">body_post =</span> <span class="st">"517514142"</span>)
  dupe =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(sp<span class="op">$</span>to))[<span class="dv">1</span>]),<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(sp),<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(sp<span class="op">$</span>to))[<span class="dv">1</span>])
  shortest =<span class="st"> </span>sp[<span class="dv">1</span><span class="op">:</span>dupe,]
  <span class="cf">if</span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest)<span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(shortest) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest)<span class="op">&lt;</span><span class="dv">5</span> ){
    shortest<span class="op">$</span>order.to =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest), <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest), <span class="dt">sep =</span> <span class="st">"/"</span>)
    shortest<span class="op">$</span>order.from =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest)<span class="op">-</span><span class="dv">1</span>, <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest), <span class="dt">sep =</span> <span class="st">"/"</span>)
    shortest[<span class="dv">1</span>,<span class="st">"order.from"</span>] =<span class="st"> </span>mbon.info[<span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(b),<span class="st">"compartment"</span>]
    shortest[<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(shortest),<span class="st">"order.to"</span>] =<span class="st"> </span>ap3.targets[<span class="st">"517514142"</span>,<span class="st">"type"</span>]
    shortest.paths =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(shortest.paths, shortest) 
  }
}

<span class="co"># Make network</span>
<span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">42</span>)
paths =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">weight =</span> shortest.paths<span class="op">$</span>weight), <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">order.from =</span> shortest.paths<span class="op">$</span>order.from,
                                                             <span class="dt">order.to =</span> shortest.paths<span class="op">$</span>order.to),
                           sum)
n =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/network/man/network.html">network</a></span>(paths,
            <span class="dt">matrix.type =</span> <span class="st">"edgelist"</span>,
            <span class="dt">ignore.eval =</span> <span class="ot">FALSE</span>,
            <span class="dt">layout =</span> <span class="st">"fruchtermanreingold"</span>,
            <span class="dt">names.eval =</span> <span class="st">"weight"</span>,
            <span class="dt">directed =</span> <span class="ot">TRUE</span>)
n <span class="op">%v%</span><span class="st"> "width"</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/ggnetwork/man/ggnetwork.html">ggnetwork</a></span>(n)<span class="op">$</span>weight),<span class="dv">0</span>,<span class="kw"><a href="https://rdrr.io/pkg/ggnetwork/man/ggnetwork.html">ggnetwork</a></span>(n)<span class="op">$</span>weight)
n =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/ggnetwork/man/ggnetwork.html">ggnetwork</a></span>(n, <span class="dt">cell.jitter =</span> <span class="fl">0.75</span>, <span class="dt">arrow.gap =</span> <span class="fl">0.01</span>)

<span class="co"># Set colours</span>
orders =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(paths<span class="op">$</span>order.to,paths<span class="op">$</span>order.from))
order.cols =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"grey30"</span>,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(orders))
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(order.cols) =<span class="st"> </span>orders
comps =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(mbon.info<span class="op">$</span>compartment)
mbon.cols =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(lacroix[[<span class="st">"pink"</span>]],<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(comps))
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(mbon.cols) =<span class="st"> </span>comps
mbon.cols =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(mbon.cols,
              order.cols[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(order.cols)<span class="op">%in%</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PPL104"</span>,<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(mbon.cols))],
              <span class="st">"PPL104"</span> =<span class="st"> </span>lacroix[[<span class="st">"orange"</span>]])

<span class="co"># Plot</span>
<span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1</span>)
<span class="kw"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="dt">file =</span> <span class="st">"images/PPL1ap3_MBON_input_graph.pdf"</span>, <span class="dt">height =</span> <span class="dv">5</span>, <span class="dt">width =</span> <span class="dv">5</span>)
<span class="kw">ggplot</span>(n, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/ggnetwork/man/geom_edges.html">geom_edges</a></span>(<span class="kw">aes</span>(<span class="dt">color =</span> vertex.names),
             <span class="dt">curvature =</span> <span class="fl">0.05</span>,
             <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">"pt"</span>), 
                           <span class="dt">type =</span> <span class="st">"closed"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/ggnetwork/man/geom_nodes.html">geom_nodes</a></span>(<span class="kw">aes</span>(<span class="dt">color =</span> vertex.names, <span class="dt">size =</span> <span class="dv">6</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/ggnetwork/man/geom_edgetext.html">geom_edgetext</a></span>(<span class="kw">aes</span>(<span class="dt">label =</span> weight, <span class="dt">color =</span> vertex.names), <span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/ggnetwork/man/geom_nodetext_repel.html">geom_nodelabel_repel</a></span>(<span class="kw">aes</span>(<span class="dt">color =</span> vertex.names, <span class="dt">label =</span> vertex.names),
                       <span class="dt">fontface =</span> <span class="st">"bold"</span>, <span class="dt">box.padding =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">"lines"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> mbon.cols) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> mbon.cols) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/ggnetwork/man/theme_blank.html">theme_blank</a></span>() <span class="op">+</span><span class="st">  </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="ot">FALSE</span>, <span class="dt">shape =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="ot">FALSE</span>, <span class="dt">linetype =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>)
<span class="kw"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</code></pre></div>
</div>
<div id="article" class="section level2">
<h2 class="hasAnchor">
<a href="#article" class="anchor"></a>Article</h2>
<p><strong>A Connectome of the Adult Drosophila Central Brain</strong></p>
<p>Shan Xu, C; Januszewski, Michal; Lu, Zhiyuan; Takemura, Shin-Ya; Hayworth, Kenneth; Huang, Gary; Shinomiya, Kazunori; Maitin-Shepard, Jeremy; Ackerman, David; Berg, Stuart; Blakely, Tim; Bogovic, John; Clements, Jody; Dolafi, Tom; Hubbard, Philip; Kainmueller, Dagmar; Katz, William; Kawase, Takashi; Khairy, Khaled; Leavitt, Laramie; Li, Peter H; Lindsey, Larry; Neubarth, Nicole; Olbris, Donald J; Otsuna, Hideo; Troutman, Eric T; Umayam, Lowell; Zhao, Ting; Ito, Masayoshi; Goldammer, Jens; Wolff, Tanya; Svirskas, Robert; Schlegel, Philipp; Neace, Erika R; Knecht, Christopher J; Alvarado, Chelsea X; Bailey, Dennis; Ballinger, Samantha; Borycz, Jolanta A; Canino, Brandon; Cheatham, Natasha; Cook, Michael; Dreyer, Marisa; Duclos, Octave; Eubanks, Bryon; Fairbanks, Kelli; Finley, Samantha; Forknall, Nora; Francis, Audrey; Hopkins, Gary Patrick; Joyce, Emily M; Kim, Sungjin; Kirk, Nicole A; Kovalyak, Julie; Lauchie, Shirley A; Lohff, Alanna; Maldonado, Charli; Manley, Emily A; McLin, Sari; Mooney, Caroline; Ndama, Miatta; Ogundeyi, Omotara; Okeoma, Nneoma; Ordish, Christopher; Padilla, Nicholas; Patrick, Christopher; Paterson, Tyler; Phillips, Elliott E; Phillips, Emily M; Rampally, Neha; Ribeiro, Caitlin; Robertson, Madelaine K; Rymer, Jon Thomson; Ryan, Sean M; Sammons, Megan; Scott, Anne K; Scott, Ashley L; Shinomiya, Aya; Smith, Claire; Smith, Kelsey; Smith, Natalie L; Sobeski, Margaret A; Suleiman, Alia; Swift, Jackie; Takemura, Satoko; Talebi, Iris; Tarnogorska, Dorota; Tenshaw, Emily; Tokhi, Temour; Walsh, John J; Yang, Tansy; Horne, Jane Anne; Li, Feng; Parekh, Ruchi; Rivlin, Patricia K; Jayaraman, Vivek; Ito, Kei; Saalfeld, Stephan; George, Reed; Meinertzhagen, Ian; Rubin, Gerald M; Hess, Harald F; Scheffer, Louis K; Jain, Viren; Plaza, Stephen M</p>
<p>bioRxiv, Jan 21, 2020 <a href="https://www.biorxiv.org/content/10.1101/2020.01.21.911859v1">10.1101/2020.01.21.911859</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#inspecting-the-hemibrain">Inspecting the hemibrain</a><ul class="nav nav-pills nav-stacked">
<li><a href="#lock-and-load">Lock and load</a></li>
      <li><a href="#find-neurons">Find neurons</a></li>
      <li><a href="#get-neuropil-volumes">Get neuropil volumes</a></li>
      <li><a href="#get-connectivity">Get connectivity</a></li>
      <li><a href="#article">Article</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alexander Bates, Gregory Jefferis, Romain Franconville.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
